<form [formGroup]="mainForm">

  <h2 class="text-2xl font-bold mb-4">Selecciona los servicios:</h2>

  <div>
    <input type="checkbox" id="seo" formControlName="seo">
    <label for="seo">Hacer una campaña SEO (300 €)</label>
  </div>

  <div>
    <input type="checkbox" id="ads" formControlName="ads">
    <label for="ads">Hacer una campaña de publicidad (400 €)</label>
  </div>

  <div>
    <input type="checkbox" id="web" formControlName="web">
    <label for="web">Hacer una página web (500 €)</label>
  </div>

  <hr class="my-6">

  @if (mainForm.controls.web.value) {
    <div [formGroup]="panelForm" class="panel-ajuste">

      <h3 class="text-xl font-semibold mb-4">Ajuste de la Página Web:</h3>

      <div class="flex items-center space-x-4 mb-4">
        <button (click)="openHelpModal('pages')" type="button"
            class="ml-3 w-6 h-6 rounded-full border-2 border-indigo-500 text-indigo-500 hover:bg-indigo-500 hover:text-white transition flex items-center justify-center text-sm font-bold">
        i
    </button>
        <label for="numPages">Número de páginas:</label>

          <button type="button"
                  (click)="updatePanelValue('numPages', -1)"
                  [disabled]="(panelForm.get('numPages')!.value ?? 0) <= 1"
                  class="w-8 h-8 rounded-full bg-indigo-500 text-white hover:bg-indigo-600 disabled:opacity-50 transition">
              –
          </button>

          <input type="number" formControlName="numPages" readonly class="w-16 text-center border border-gray-300 rounded-md p-1 font-semibold">

          <button type="button"
                  (click)="updatePanelValue('numPages', 1)"
                  class="w-8 h-8 rounded-full bg-indigo-500 text-white hover:bg-indigo-600">
              +
          </button>
      </div>

      <div class="flex items-center space-x-4">
        <button (click)="openHelpModal('languages')" type="button"
            class="ml-3 w-6 h-6 rounded-full border-2 border-indigo-500 text-indigo-500 hover:bg-indigo-500 hover:text-white transition flex items-center justify-center text-sm font-bold">
        i
    </button>
        <label for="numLanguages">Número de idiomas:</label>

          <button type="button"
                  (click)="updatePanelValue('numLanguages', -1)"
                  [disabled]="(panelForm.get('numLanguages')!.value ?? 0) <= 1"
                  class="w-8 h-8 rounded-full bg-indigo-500 text-white hover:bg-indigo-600 disabled:opacity-50 transition">
              –
          </button>

          <input type="number" formControlName="numLanguages" readonly class="w-16 text-center border border-gray-300 rounded-md p-1 font-semibold">

          <button type="button"
                  (click)="updatePanelValue('numLanguages', 1)"
                  class="w-8 h-8 rounded-full bg-indigo-500 text-white hover:bg-indigo-600">
              +
          </button>
      </div>
  </div>
  }
</form>

@if (activeHelpModal() !== 'closed') {
  <div class="fixed inset-0 bg-blur bg-opacity-70 flex items-center justify-center z-50"
       (click)="closeHelpModal()">

    <div class="bg-white p-8 rounded-xl shadow-2xl max-w-sm w-full mx-4"
         (click)="$event.stopPropagation()">

      <h4 class="text-2xl font-bold mb-4 text-center text-gray-800">
        @if (activeHelpModal() === 'pages') {
          Número de Páginas
        } @else {
          Número de Idiomas
        }
      </h4>

      @if (activeHelpModal() === 'pages') {
        <p class="mb-6 text-center text-gray-700">
            Añade las páginas que tendrá tu web, teniendo en cuenta que el precio base ya incluye una. El coste de cada página adicional es de {{ budgetService.PRICE_PER_MODULE }}€.
        </p>
      } @else {
        <p class="mb-6 text-center text-gray-700">
            Añade los idiomas a los que se traducirá tu proyecto, teniendo en cuenta que el precio base ya incluye un idioma principal. El coste de cada idioma adicional es de {{ budgetService.PRICE_PER_MODULE }}€.
        </p>
      }


      <div class="text-center">
        <button (click)="closeHelpModal()"
                class="px-6 py-2 bg-indigo-500 text-white font-medium rounded-lg hover:bg-indigo-700 transition">
          Entendido
        </button>
      </div>
    </div>
  </div>
}

<div class="mt-8 p-4 bg-gray-100 font-bold text-lg">
PRECIO TOTAL:
<span>{{ budgetService.totalPrice() | number:'1.2-2' }} €</span>
</div>
